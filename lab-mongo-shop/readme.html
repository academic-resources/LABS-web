<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>readme</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="pp-mongo-shop">PP | Mongo Shop</h1>
<p><img src="https://i.imgur.com/IJKRm71.png" width="300px"></p>
<h2 id="introduction">Introduction</h2>
<p>We want to build a small database for an e-commerce application.</p>
<p>We interviewed the client and she gave us the following requirements for the application:</p>
<ul>
<li>She wants to store products with some information</li>
<li>She needs to save the client information</li>
<li>Should be able to look the shopping history of every client</li>
<li>Products can have a category</li>
<li>Users can review products and rate them by assigning 1 to 5 stars</li>
</ul>
<p>With this information, we should be able to get started in modeling our Mongo Database. Ready?</p>
<h2 id="modeling-the-data">Modeling the Data</h2>
<p>First of all we need identify the entities in order to create our collections.</p>
<h3 id="collections">Collections</h3>
<p>There are differents ways to design the structure. If we come from the world of SQL an approach can be, 4 collections: Users, Products, ShoppingCarts and Reviews. But we are in MongoDB were we can embed documents and we will follow the proposed structure.</p>
<ul>
<li>Users
<ul>
<li>ShoppingCarts</li>
</ul></li>
<li>Products
<ul>
<li>Reviews</li>
</ul></li>
</ul>
<p>The structured proposed is 2 collections <code>users</code> and <code>products</code>, inside the collection <code>users</code> we will store the historical purchases. In the <code>products</code> collection we will have the reviews of each product.</p>
<p>Each of these collections will have inside the information that we need to store.</p>
<h3 id="data-model">Data Model</h3>
<p>Once we define our collections, we should define what fields the documents inside the collections will have. Once again, there are many different ways of doing this, but for this exercise, we are going to model the database like this:</p>
<p><strong>Sample User collection</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_id&quot;</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;582e3c59eb1b8eb7be087448&quot;</span>)<span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;firstName&quot;</span><span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;lastName&quot;</span><span class="op">:</span> <span class="st">&quot;Smith&quot;</span><span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dateBirth&quot;</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2016-12-10T18:28:09.369Z&quot;</span>)<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;address&quot;</span><span class="op">:</span> {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;streetAddress&quot;</span><span class="op">:</span> <span class="st">&quot;21 2nd Street&quot;</span><span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;city&quot;</span><span class="op">:</span> <span class="st">&quot;New York&quot;</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;state&quot;</span><span class="op">:</span> <span class="st">&quot;NY&quot;</span><span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;postalCode&quot;</span><span class="op">:</span> <span class="st">&quot;10021&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;shoppingCart&quot;</span><span class="op">:</span> [</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ObjectId</span>(<span class="st">&quot;582e3dd006a0c0b81841f47e&quot;</span>)<span class="op">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ObjectId</span>(<span class="st">&quot;582e3cc7b03b5db7dd616cc8&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Sample Products Collection</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;_id&quot;</span><span class="op">:</span> <span class="fu">ObjectId</span>(<span class="st">&quot;582e3dd006a0c0b81841f47e&quot;</span>)<span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;WiredTiger T-shirt&quot;</span><span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;description&quot;</span><span class="op">:</span><span class="st">&quot;Crafted from ultra-soft combed cotton, this essential t-shirt features sporty contrast tipping and MongoDB&#39;s signature leaf.&quot;</span><span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;category&quot;</span><span class="op">:</span><span class="st">&quot;Apparel&quot;</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;reviews&quot;</span><span class="op">:</span> [</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Shannon&quot;</span><span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;comment&quot;</span><span class="op">:</span> <span class="st">&quot;This is so warm and comfortable.&quot;</span><span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;stars&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;date&quot;</span><span class="op">:</span> <span class="st">&quot;2016-11-10T18:28:09.369Z&quot;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Shannon&quot;</span><span class="op">,</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;comment&quot;</span><span class="op">:</span> <span class="st">&quot;This is so warm and comfortable.&quot;</span><span class="op">,</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;stars&quot;</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;date&quot;</span><span class="op">:</span> <span class="st">&quot;2016-11-10T18:28:09.369Z&quot;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    }]<span class="op">,</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;price&quot;</span><span class="op">:</span><span class="fl">12.0</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="part-1-crud-in-mongoshell">PART 1 | CRUD in MongoShell</h2>
<h3 id="create-a-database-name">1.1 | Create a database name</h3>
<p>The first step to start the exercise is to create our own database. Let‚Äôs call it <code>myShop</code>:</p>
<pre><code>$ mongo
MongoDB shell version: 3.2.11
connecting to: test

&gt; use myShop
switched to db myShop</code></pre>
<h3 id="insert-our-first-users-in-users-collection">1.2 | Insert our first users in <code>users</code> collection</h3>
<p>Insert this user in the <code>users</code> collection:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;firstName&quot;</span><span class="op">:</span> <span class="st">&quot;John&quot;</span><span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;lastName&quot;</span><span class="op">:</span> <span class="st">&quot;Smith&quot;</span><span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dateBirth&quot;</span><span class="op">:</span> <span class="fu">ISODate</span>(<span class="st">&quot;2016-12-10T18:28:09.369Z&quot;</span>)<span class="op">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;address&quot;</span><span class="op">:</span> {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;streetAddress&quot;</span><span class="op">:</span> <span class="st">&quot;21 2nd Street&quot;</span><span class="op">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;city&quot;</span><span class="op">:</span> <span class="st">&quot;New York&quot;</span><span class="op">,</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;state&quot;</span><span class="op">:</span> <span class="st">&quot;NY&quot;</span><span class="op">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;postalCode&quot;</span><span class="op">:</span> <span class="st">&quot;10021&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>After you insert it, don‚Äôt forget to check that the user is inserted correctly and add yourselves as users in the collection too!</p>
<h3 id="insert-our-first-products-in-products-collection">1.3 | Insert our first products in <code>products</code> collection</h3>
<p>Now let‚Äôs add a product to our <code>products</code> collection:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Water Bottle&quot;</span><span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;description&quot;</span><span class="op">:</span><span class="st">&quot;High quality glass bottle provides a healthier way to drink.  Silicone sleeve provides a good grip, a see-through window, and protects the glass vessel.  Eliminates toxic leaching that plastic can cause.  Innovative design holds 22-1/2 ounces.  Dishwasher safe&quot;</span><span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;category&quot;</span><span class="op">:</span><span class="st">&quot;Kitchen&quot;</span><span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">&quot;price&quot;</span><span class="op">:</span><span class="fl">23.0</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Dont‚Äô forget to check that the product is inserted correctly and insert a product for each of you :)</p>
<h3 id="getting-started-with-queries">1.4 | Getting Started with queries</h3>
<ol type="1">
<li><p>Create a purchase with some products for the user. &gt; Remember that purchases are the elements inside the <code>"shoppingCart"</code> array property of a <code>user</code>.</p></li>
<li><p>List all <code>products</code></p></li>
<li><p>List all <code>products</code> with the same <code>category</code></p></li>
<li><p>Delete a <code>product</code></p></li>
<li><p>Write a review for one product</p></li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;reviews&quot;</span><span class="op">:</span> [</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Shannon&quot;</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;comment&quot;</span><span class="op">:</span> <span class="st">&quot;This is so warm and comfortable.&quot;</span><span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;stars&quot;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;date&quot;</span><span class="op">:</span> <span class="st">&quot;2016-11-10T18:28:09.369Z&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  ]</span></code></pre></div>
<h2 id="welcome-the-nodejs-driver">Welcome the NodeJS driver</h2>
<p><img src="https://i.imgur.com/eS8Mlzb.png" /></p>
<p>Until now we played with MongoShell, In Part 2 let‚Äôs play with <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB Driver for NodeJS</a>.</p>
<h4 id="connecting-to-mongo-database">Connecting to Mongo Database</h4>
<p>To make the connection between NodeJS and MongoDB we use the MongoDB Driver, which is a package we need to install:</p>
<pre class="shell"><code>$ npm install mongodb --save</code></pre>
<p>The code below is a basic script to connect to your local MongoDB.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MongoClient <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;mongodb&#39;</span>)<span class="op">.</span><span class="at">MongoClient</span><span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> dbServer <span class="op">=</span> <span class="st">&#39;localhost&#39;</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> dbPort   <span class="op">=</span> <span class="st">&#39;27017&#39;</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> dbName   <span class="op">=</span> <span class="st">&#39;ironhackshop&#39;</span><span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> connectionURL <span class="op">=</span> <span class="vs">`mongodb://</span><span class="sc">${</span>dbServer<span class="sc">}</span><span class="vs">:</span><span class="sc">${</span>dbPort<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>dbName<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Use connect method to connect to the server</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>MongoClient<span class="op">.</span><span class="fu">connect</span>(connectionURL<span class="op">,</span> <span class="kw">function</span>(error<span class="op">,</span> db) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(error) { <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Error connecting to server&quot;</span><span class="op">,</span> error)<span class="op">;</span> <span class="cf">return</span><span class="op">;</span>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Connected successfully to server&quot;</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Make your queries here   </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  db<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<p>First we are importing <code>MongoClient</code> from <code>mongodb</code>, that is the driver package for NodeJS.</p>
<p>We use <code>MongoClient.connect()</code> to establish the connection to MongoDB. Connect recieves two argumments, one is the database‚Äôs URL, and the other is a callback that will be called when the connection to the Database is available.</p>
<p>This callback will have two parameters:</p>
<ul>
<li><code>error</code>, if there are any problems</li>
<li><code>db</code>: the database object we will use to perform queries</li>
</ul>
<h3 id="how-to-perform-queries-in-nodejs">How to perform queries in NodeJS</h3>
<p>In order to perform queries with the driver, we need to use the <code>db</code> object returned in the connection callback.</p>
<p>The <code>db</code> object has a method <code>db.collection()</code> that allows us to performa a <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#find">find query</a> on that collection.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>db<span class="op">.</span><span class="fu">collection</span>(<span class="st">&#39;products&#39;</span>)<span class="op">.</span><span class="fu">find</span>()<span class="op">.</span><span class="fu">toArray</span>((error<span class="op">,</span> products) <span class="kw">=&gt;</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    assert<span class="op">.</span><span class="fu">equal</span>(error<span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;All Products: &#39;</span><span class="op">,</span> products)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>We can invoke <code>collection('&lt;collectionName&gt;')</code> method to perform queries on a particular collection.</p>
<p>Over collection we can apply almost the same methods that we were applaying in MongoShell, but we strongly recommend check the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/">documentacion of MongoDB Driver</a>.</p>
<p><strong>Let‚Äôs get our hands dirty!!!!</strong></p>
<p><img src="https://media.giphy.com/media/9DkT78OOEFoxG/source.gif" /></p>
<h2 id="part-2-crud-in-nodejs-driver">PART 2 | CRUD in NodeJS driver</h2>
<h3 id="lab-0-setup-repository">Lab 0 | Setup Repository</h3>
<p>You are gonna build an e-commerce terminal application.</p>
<pre class="shell"><code>$ git clone https://github.com/ironhack/lab-mongo-shop</code></pre>
<p>Once you‚Äôve downloaded the repo, enter in that folder and type:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>$ cd lab<span class="op">-</span>mongo<span class="op">-</span>shop</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>$ npm install</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>$ npm start</span></code></pre></div>
<p>The project has the following structure</p>
<table>
<colgroup>
<col style="width: 68%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th>Folder</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>/data</code></td>
<td>Folder that contain the json for collections</td>
</tr>
<tr class="even">
<td><code>database.js</code></td>
<td>Class to connect to MongoDB Driver</td>
</tr>
<tr class="odd">
<td><code>questions.js</code></td>
<td>Class to interact through the prompt terminal and ask questions</td>
</tr>
<tr class="even">
<td><code>main.js</code></td>
<td>Our main file, where everything starts</td>
</tr>
</tbody>
</table>
<p>Open the project with your editor</p>
<h3 id="lab-1-insert-user">Lab 1 | Insert User</h3>
<p>Open <code>database.js</code>. This is the file you have to perform the differents queries.</p>
<p>Find the method <code>insertUser(&lt;user&gt;, callback(error, result))</code> we call the method <code>this.connect</code> and inside his callback, if there is an error we invoke our callback with the error if everything went well we will use <code>database</code> object to connect to our DB.</p>
<pre class="javascript="><code>insertUser(user, callback = (error, result) =&gt; {}){
  this.connect((error, database) =&gt; {
    if (error){
      callback(error);
    } else {
      // LAB 1
      // Implement the query to insert a user
      // remeber once it&#39;s finish to comment callback(&#39;Error inserting user&#39;);

      callback(&#39;Error inserting user&#39;);
    }
  });
}</code></pre>
<p>In line 9 type <code>database.collection('users').insertOne();</code></p>
<p>If we check the documentation <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#insertOne">insertOne(doc, options, callback)</a> - <code>doc</code> is the document to insert - <code>options</code> we are not gonna use it now - <code>callback</code> is the command result callback.</p>
<pre class="javascript=5"><code>...
} else {
  // LAB 1
  // Implement the query to insert a user
  // remeber once it&#39;s finish to comment callback(&#39;Error inserting user&#39;);
  database.collection(&#39;users&#39;).insertOne(user, callback);
  callback(&#39;Error inserting user&#39;);
}
...</code></pre>
<p><code>user</code> is the document to insert and we are passing callback from <code>insertOne</code> invoked inside <code>insertOne</code> to our callback in line 1.</p>
<p>We are doing this because, the callback from insertOne has the same signature than our callback (line 1).</p>
<p>Let‚Äôs try it in our first function:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>$ npm start</span></code></pre></div>
<p>Select option 1 &gt; option 1 ‚ÄúUser &gt; Insert a user‚Äù. follow the instructions.</p>
<p><img src="https://i.imgur.com/81OQBJn.png" /> <img src="https://i.imgur.com/8zhaeFI.png" /></p>
<p>Once is inserted go to MongoShell and see if was inserted correctly.</p>
<h3 id="lab-exercises">Lab Exercises</h3>
<p>Perform the different queries, the column Function Name is that you have to finish.</p>
<table>
<thead>
<tr class="header">
<th>Lab</th>
<th>Description</th>
<th>Function Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Insert a users</td>
<td><code>insertUser</code></td>
</tr>
<tr class="even">
<td>2</td>
<td>List all users</td>
<td><code>listUsers</code></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Delete a user</td>
<td><code>deleteUser</code></td>
</tr>
<tr class="even">
<td>4</td>
<td>Insert a product</td>
<td><code>insertProduct</code></td>
</tr>
<tr class="odd">
<td>5</td>
<td>List all products</td>
<td><code>listProducts</code></td>
</tr>
<tr class="even">
<td>6</td>
<td>Delete a product</td>
<td><code>deleteProduct</code></td>
</tr>
<tr class="odd">
<td>7</td>
<td>Buy a product</td>
<td><code>addProductToShoppingCart</code></td>
</tr>
<tr class="even">
<td>8</td>
<td>Make a review</td>
<td><code>addReviewToProduct</code></td>
</tr>
</tbody>
</table>
<p>// Happy Coding! üòÄ</p>
<h2 id="summary">Summary</h2>
<p>In this exercise we‚Äôve practised the basics queries in MongoShell also we‚Äôve learned how to connect NodeJS through MongoDB Driver to the DB.</p>
<h2 id="extra-resources">Extra Resources</h2>
<p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/">Reference API MongoDB Driver</a> <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB Driver Website</a> <a href="http://mongodb.github.io/node-mongodb-native/2.2/quick-start/">Getting Started</a></p>
</body>
</html>
